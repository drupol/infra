{
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": {
          "type": "grafana",
          "uid": "-- Grafana --"
        },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "id": 149,
  "links": [],
  "panels": [
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 0
      },
      "id": 11,
      "panels": [],
      "title": "A propos de Noise Station et la r√©glementation du bruit",
      "type": "row"
    },
    {
      "fieldConfig": {
        "defaults": {},
        "overrides": []
      },
      "gridPos": {
        "h": 43,
        "w": 12,
        "x": 0,
        "y": 1
      },
      "id": 6,
      "options": {
        "code": {
          "language": "plaintext",
          "showLineNumbers": false,
          "showMiniMap": false
        },
        "content": "# Noise Station\n\n### Un syst√®me de monitoring acoustique intelligent\n\nLa **Noise Station** est une solution de surveillance environnementale de haute pr√©cision con√ßue pour capturer, analyser et visualiser les niveaux sonores d'un espace en temps r√©el. Elle transforme des donn√©es acoustiques brutes en indicateurs visuels pour suivre l'√©volution du bruit, d√©tecter les pics et comprendre le profil sonore d'un lieu sur 24 heures.\n\n# Comment √ßa fonctionne ?\n\n### 1. La Capture (Le Mat√©riel)\n\nLe syst√®me s'appuie sur un microphone professionnel de type **Trotec SL400** (√©quivalent du **CEM DT-8852**). Ce sonom√®tre de Classe 2 offre des fonctionnalit√©s indispensables :\n\n- **Double Pond√©ration:** Supporte les courbes **dB(A)** (perception humaine) et **dB(C)** (basses fr√©quences).\n- **Plage Dynamique:** Mesure pr√©cise de 30 √† 130 dB (pr√©cision : 1,4 dB, r√©solution : 0,1 dB)\n- **Modes Temporels:** Analyse en mode \"Fast\" (r√©activit√© imm√©diate) ou \"Slow\" (stabilit√©).\n- **Signaux num√©riques:** Uniquement les donn√©es num√©riques (et pas analogique) sont transmises.\n- **Certification:** Livr√© avec certificat de calibration, conforme √† IEC61672-1 Class 2\n\n### 2. Le C≈ìur du Syst√®me (L'Intelligence)\n\nLes flux de donn√©es sont orchestr√©s par un micro-serveur Raspberry Pi et centralis√©s dans une base de donn√©es sp√©cialis√©e dans l'analyse temporelle:\n\n- **Raffinage:** Nettoyage et filtrage rigoureux des m√©tadonn√©es pour garantir une exploitation fluide et coh√©rente.\n- **Optimisation de pr√©cision:** Gestion intelligente des volumes massifs de donn√©es afin d'assurer un rendu graphique haute fid√©lit√©, parfaitement fid√®le √† la r√©alit√© du terrain.\n- **Analyse Statistique:** Agr√©gation automatis√©e des donn√©es brutes en indicateurs acoustiques complexes.\n\n### 3. La Visualisation (Le Dashboard)\n\nLe tableau de bord est con√ßu comme un outil d'aide √† la d√©cision et de preuve technique. Il est structur√© en trois niveaux de lecture pour offrir une visibilit√© totale sur l'environnement sonore.\n\n#### A. Pilotage et Conformit√© L√©gale (Temps R√©el)\n\nCe module permet de v√©rifier instantan√©ment si l'installation respecte la l√©gislation wallonne.\n\n- **Contr√¥le de Conformit√© Dynamique :** Un graphique principal qui compare le niveau m√©dian (**L50**) aux seuils r√©glementaires (40/45/50 dB). Gr√¢ce √† un algorithme de filtrage, il isole les bruits continus (PAC) des bruits parasites (avions, voitures).\n- **Journal des Infractions :** Un syst√®me d'alerte visuel avec temporisation. Une infraction n'est valid√©e et enregistr√©e en **rouge** que si le d√©passement des seuils persiste plus de **2 minutes**.\n- **Indicateurs de S√©v√©rit√© :** Une jauge affiche le **taux de d√©passement global** (en %), r√©pondant pr√©cis√©ment √† la question : \"Quelle proportion du temps le voisinage a-t-il subi une nuisance ?\"\n\n#### B. Diagnostic et Analyse d'Impact\n\nCes outils permettent de mesurer la gravit√© r√©elle de la nuisance et ses causes.\n\n- **Analyse des √âmergences :** Un graphique d√©di√© au \"surplus\" sonore. Il affiche uniquement l'√©cart (en dB) entre le bruit mesur√© et la limite l√©gale, permettant de quantifier pr√©cis√©ment la g√™ne.\n- **Corr√©lation Thermique :** Int√©gration de la **temp√©rature ext√©rieure** pour mettre en √©vidence le lien entre le froid et l'augmentation du r√©gime de la pompe √† chaleur (cycles de d√©givrage, mont√©e en puissance du compresseur).\n- **Historique Quotidien :** Une vue r√©trospective sur 24h pour comparer les performances acoustiques d'un jour √† l'autre et identifier des tendances hebdomadaires.\n\n#### C. Expertise Acoustique Avanc√©e\n\nPour une analyse plus pointue, le dashboard fournit les m√©triques norm√©es utilis√©es par les experts en acoustique.\n\n- **Bilan √ânerg√©tique Global (Lden) :** Calcul automatique de l'indice de r√©f√©rence europ√©en, incluant les p√©nalit√©s de soir√©e et de nuit pour √©valuer la g√™ne r√©elle sur le long terme.\n- **Signature et Monotonie du Bruit :** Utilisation de l'indice de monotonie (**L10 - L90**) pour qualifier la source. Un √©cart faible (< 5dB) confirme techniquement un bruit de type industriel/m√©canique (stable), tandis qu'un √©cart fort (> 15dB) indique des bruits al√©atoires.\n- **Distribution Statistique :** Un profil complet via les percentiles (**L10, L50, L90**) et un histogramme de fr√©quence pour comprendre la structure du climat sonore (poids du bruit de fond vs pics de pollution sonore).\n- **Cartographie :** G√©olocalisation pr√©cise du point de mesure pour contextualiser l'emplacement du capteur par rapport aux r√©cepteurs (voisins, fa√ßades).\n\n# Pourquoi utiliser Noise Station ?\n\nPasser du ressenti subjectif (\"c'est bruyant\") √† une mesure objective (\"la moyenne est de 65 dB avec des pics √† 85 dB\"). Que ce soit pour le confort au travail, la surveillance de voisinage ou l'analyse environnementale, la **Noise Station** fournit une preuve scientifique et visuelle de la r√©alit√© acoustique de votre environnement.\n",
        "mode": "markdown"
      },
      "pluginVersion": "12.3.2",
      "title": "",
      "type": "text"
    },
    {
      "fieldConfig": {
        "defaults": {},
        "overrides": []
      },
      "gridPos": {
        "h": 18,
        "w": 12,
        "x": 12,
        "y": 1
      },
      "id": 7,
      "options": {
        "code": {
          "language": "plaintext",
          "showLineNumbers": false,
          "showMiniMap": false
        },
        "content": "En R√©gion Wallonne (https://www.ejustice.just.fgov.be/eli/arrete/2002/07/04/2002027815/justel), le cadre l√©gal est clair et rigoureux. Depuis l‚Äôarr√™t√© du Gouvernement wallon du 4 juillet 2022, des limites de bruit sp√©cifiques s‚Äôappliquent aux PAC selon les diff√©rentes p√©riodes de la journ√©e :\n\n- En journ√©e (7h-19h): le bruit ne doit pas d√©passer 50 dB.\n- En transition (6h-7h, 19h-22h): la limite est r√©duite √† 45 dB.\n- La nuit (22h-6h): le niveau sonore doit imp√©rativement rester sous 40 dB.\n\nLe bruit se propage en cercle autour d'une unit√© ext√©rieure (PAC). \nIl est donc crucial de faire attention aux surfaces environnantes, comme des murs ou d‚Äôautres b√¢timents, qui peuvent r√©fl√©chir le son et provoquer un effet d‚Äô√©cho. Pour limiter cette r√©sonance, maintenez au moins un m√®tre d‚Äôespace autour de la pompe, en particulier par rapport aux fen√™tres, aux portes et aux chemins. Si l‚Äôunit√© est plac√©e contre un mur, veillez √† respecter une distance minimale de 30 centim√®tres ‚Äî l‚Äôid√©al √©tant de 50 centim√®tres ‚Äî pour garantir une circulation sonore optimale. Il est √©galement important de prendre en compte la distance entre la face avant de la pompe √† chaleur et les trottoirs, qui doit √™tre d‚Äôau moins 3 m√®tres et d‚Äôau moins 6 m√®tres pour les plantes.\n\nDes recherches ont montr√© qu'un stress prolong√© caus√© par le bruit augmente le risque de maladies cardiovasculaires, comme l'hypertension art√©rielle ou les maladies coronariennes. \nCe risque augmente avec la dur√©e et l'intensit√© de la nuisance sonore, surtout lorsqu'il s'agit de bruit en soir√©e ou la nuit. \n\nL'Organisation Mondiale de la Sante recommande de ne pas depasser les 40 dB(A) a partir de 22h et jusque 7h du matin.\n\nSources: \n- https://www.bobex.be/fr-be/pompe-a-chaleur/installation/distance-voisin/\n- https://www.health.belgium.be/fr/themes/sante/votre-sante/environnement-sante/impact-nuisances-sonores-votre-sante/son-nuisances-sonores\n- https://www.who.int/europe/fr/publications/i/item/WHO-EURO-2018-3287-43046-60243?hl=en-US\n- https://www.polisnetwork.eu/wp-content/uploads/2019/06/who-night-noise-guidelines.pdf\n",
        "mode": "markdown"
      },
      "pluginVersion": "12.3.2",
      "title": "R√©glementation",
      "type": "text"
    },
    {
      "fieldConfig": {
        "defaults": {},
        "overrides": []
      },
      "gridPos": {
        "h": 25,
        "w": 12,
        "x": 12,
        "y": 19
      },
      "id": 25,
      "options": {
        "code": {
          "language": "plaintext",
          "showLineNumbers": false,
          "showMiniMap": false
        },
        "content": "### Comprendre les Indicateurs et Pond√©rations Acoustiques\n\nLes mesures affich√©es sur ce tableau de bord utilisent des pond√©rations fr√©quentielles normalis√©es pour traduire une\nr√©alit√© physique (la pression du son) en une donn√©e interpr√©table.\n\n#### 1. La Pond√©ration dB(A) : La R√©f√©rence L√©gale\n\nLa pond√©ration **dB(A)** est con√ßue pour imiter la sensibilit√© de l‚Äôoreille humaine, qui per√ßoit moins bien les sons\ngraves que les sons aigus.\n\n- **Usage :** C‚Äôest l‚Äôunique r√©f√©rence utilis√©e par la r√©glementation (R√©gion Wallonne, OMS) pour d√©finir les seuils de\n  conformit√©.\n- **Limite :** En att√©nuant fortement les basses fr√©quences, le dB(A) a tendance √† \"masquer\" les nuisances sourdes. Une\n  installation peut donc √™tre **l√©galement conforme** en dB(A) tout en g√©n√©rant une g√™ne r√©elle importante.\n\n#### 2. La Pond√©ration dB(C) : L'Analyse Physique\n\nLa pond√©ration **dB(C)** est beaucoup plus lin√©aire. Elle n'att√©nue quasiment pas les basses fr√©quences et mesure\nl'√©nergie sonore globale.\n\n- **Usage :** Elle est indispensable pour d√©tecter les ronronnements et vrombissements des √©quipements m√©caniques\n  (compresseurs de pompes √† chaleur, moteurs).\n- **Int√©r√™t :** Un √©cart important entre la mesure en dB(C) et celle en dB(A) (g√©n√©ralement plus de 15 dB) r√©v√®le la\n  pr√©sence de **pollutions sonores √† basses fr√©quences**, souvent ignor√©es par les sonom√®tres standards.\n\n#### 3. Focus : Le Bruit Solidien et les Vibrations\n\nLe **bruit solidien** est une nuisance particuli√®re o√π le son ne voyage pas seulement par l'air, mais se propage √†\ntravers les **structures solides** (murs, dalles de b√©ton, tuyauteries).\n\n- **Le probl√®me :** Une pompe √† chaleur mal isol√©e du sol transmet des vibrations qui font \"r√©sonner\" le b√¢timent.\n- **L'incapacit√© du dB(A) :** Comme ces vibrations se manifestent par des fr√©quences tr√®s basses, le dB(A) ne permet pas\n  de les mesurer efficacement.\n- **Le diagnostic :** Seule l'analyse en **dB(C)** permet de quantifier l'√©nergie de ces vibrations. C'est ce qui\n  explique pourquoi un voisin peut \"ressentir\" un vrombissement insupportable √† l'int√©rieur de sa chambre alors que la\n  mesure officielle en dB(A) √† l'ext√©rieur semble normale.\n",
        "mode": "markdown"
      },
      "pluginVersion": "12.3.2",
      "title": "Pond√©rations acoustiques dB(A) et dB(C)",
      "type": "text"
    },
    {
      "fieldConfig": {
        "defaults": {},
        "overrides": []
      },
      "gridPos": {
        "h": 49,
        "w": 24,
        "x": 0,
        "y": 44
      },
      "id": 17,
      "options": {
        "code": {
          "language": "plaintext",
          "showLineNumbers": false,
          "showMiniMap": false
        },
        "content": "### Vue en Temps R√©el (Graphique Principal)\n\nLe panneau central de **contr√¥le de conformit√©**. Il affiche le bruit mesur√© face √† la limite l√©gale dynamique.\n\n- **Logique de Filtre** : Utilise le **L50** (M√©diane) pour √©carter les bruits brefs (voitures, avions) et isoler le bruit continu (PAC).\n- **Temporisation** : Une infraction n'est signal√©e que si le d√©passement dure **plus de 2 minutes**.\n  - üü¢ **Vert** : Conforme.\n  - üî¥ **Rouge** : Infraction confirm√©e (> 2 min).\n\n### Historique des Infractions (Frise Chronologique)\n\nUn bandeau simple qui fait office de **journal des non-conformit√©s**. Il indique en rouge les p√©riodes o√π le bruit a √©t√© officiellement jug√© excessif (apr√®s la tol√©rance de 2 min).\n\n### Analyse des √âmergences (Graphique d'√âcarts)\n\nCe graphique focus uniquement sur le **surplus de bruit**. Il montre de combien de d√©cibels la limite a √©t√© franchie. Utile pour mesurer la gravit√© de la nuisance.\n\n### Taux de D√©passement (Jauge %)\n\nUn indicateur de s√©v√©rit√© globale. Il r√©pond √† la question : _\"Quel pourcentage du temps avons-nous pass√© en infraction ?\"_.\n\n- **Seuils pris en compte** : 50dB (Jour) / 45dB (Transition) / 40dB (Nuit).\n\n### Temp√©rature Ext√©rieure\n\nMet en corr√©lation le bruit et le froid. Une pompe √† chaleur √©tant plus bruyante √† basse temp√©rature, ce graphique aide √† contextualiser les nuisances hivernales.\n\nCette section compl√®te la surveillance temps r√©el par une analyse approfondie de l'environnement sonore. Elle se d√©compose en **5 outils d'expertise** :\n\n### Indicateurs de Pression Acoustique (Graphique Temporel)\n\nVisualisation de la **dynamique du bruit** √† l'instant T.\n\n- Superpose le bruit brut (**SPL**) et les statistiques (**L10/L50/L90**).\n- Permet de voir _comment_ le bruit √©volue : est-ce un pic isol√© (L10 monte seul) ou une augmentation g√©n√©rale du fond (L90 monte aussi) ?\n- Affiche les **seuils r√©glementaires** en pointill√© pour rep√©rer les infractions instantan√©es.\n\n### Synth√®se avanc√©e de l'environnement sonore et analyse statistique instantan√©e des indicateurs acoustiques.\n\nUn **bilan chiffr√© complet** sur la p√©riode affich√©e. Il pr√©sente les m√©triques cl√©s pour l'acusticien :\n\n- **Lden** (Day-Evening-Night) : L'indice de r√©f√©rence europ√©en de g√™ne globale (p√©nalit√©s soir/nuit incluses).\n- **Leq** : La moyenne √©nerg√©tique pure.\n- **Percentiles (L10/L50/L90)** : La structure statistique du bruit (Pics / M√©diane / Fond).\n- **SEL** : L'exposition sonore totale cumul√©e.\n\n### Synth√®se avanc√©e de l'environnement sonore et analyse statistique quotidenne des indicateurs acoustiques.\n\nUn graphique r√©trospectif qui agr√®ge les mesures **jour par jour**. Indispensable pour comparer la nuisance d'aujourd'hui, d'hier ou de la semaine pass√©e.\n\n- Affiche le **Lden** quotidien ainsi que les **Lday** / **Lnight**.\n- Permet de v√©rifier si une journ√©e a √©t√© globalement plus bruyante que la normale.\n\n##### Pourquoi comparer Leq et Lden ?\n\n1.  **C'est la base de comparaison r√©elle :** Le Leq est la \"vraie\" moyenne physique du bruit. En le comparant au Lden, vous pouvez quantifier l'impact des p√©nalit√©s du soir et de la nuit. Si le Lden est beaucoup plus √©lev√© que le Leq, cela prouve techniquement que la nuisance est majoritairement nocturne.\n2.  **Validation scientifique :** Dans un rapport acoustique, le Leq est l'indicateur standard universel. Il permet de s'assurer qu'il n'y a pas d'erreur de calcul dans les indicateurs pond√©r√©s.\n3.  **Analyse de la source :** Pour une machine comme une PAC qui tourne de mani√®re constante, le Leq sera tr√®s proche du L50. S'ils divergent, cela signifie que le bruit est pollu√© par des bruits intermittents (trafic, oiseaux, vent).\n\nLe Lden est un indice de **g√™ne** (subjectif/l√©gal), le Leq est un indice d'**√©nergie** (objectif). Avoir les deux sur votre graphique de synth√®se quotidienne permet une expertise compl√®te.\n\n### Analyse de Densit√© : Intensit√© vs Cycle Circadien\n\nCe graphique de corr√©lation analyse la distribution de chaque mesure acoustique sur un cycle de 24 heures (axe vertical), ind√©pendamment du jour calendaire. Il permet d‚Äôisoler visuellement les **nuisances m√©caniques cycliques** (r√©currences) des bruits al√©atoires de l'environnement, tout en mettant en relief la s√©v√©rit√© des infractions par rapport aux seuils l√©gaux.\nCe graphique constitue une **\"preuve par la r√©currence\"**. Si une tache dense appara√Æt syst√©matiquement en p√©riode nocturne (22h-07h) au-del√† de 40 dB, cela d√©montre math√©matiquement que la nuisance n'est pas accidentelle mais structurelle, li√©e au fonctionnement d'un √©quipement fixe.\n\nCe panneau propose une lecture multidimensionnelle de votre environnement sonore :\n\n- Les Axes (Le \"O√π\" et \"Quand\")\n  - **Axe Horizontal (X) :** Intensit√© du bruit en d√©cibels pond√©r√©s A (dB(A)).\n  - **Axe Vertical (Y) :** Heure de la journ√©e (de 00h √† 23h59). Chaque point repr√©sente une mesure prise √† un instant T sur la p√©riode s√©lectionn√©e (ex: les 7 derniers jours).\n- L‚ÄôEffet de Densit√© (Le \"Nuage\" de points)\n  - Le graphique utilise la semi-transparence. Plus une zone est **sombre ou dense**, plus le niveau de bruit mesur√© √† cette heure pr√©cise est **r√©current**.\n  - **Une ligne verticale sombre** indique une source sonore stable et constante (signature typique d'une **pompe √† chaleur** ou d'une ventilation).\n  - **Des points dispers√©s** indiquent des √©v√©nements al√©atoires (passages de v√©hicules, vent, bruits de voisinage).\n- Taille et Couleur des Points (La S√©v√©rit√©)\n  - La taille des points augmente proportionnellement au **d√©passement des limites l√©gales wallonnes** (40 dB la nuit, 45 dB en transition, 50 dB le jour).\n  - **Gros points (Rouge/Fonc√©) :** Infractions majeures n√©cessitant une action corrective.\n  - **Petits points (Vert/Clair) :** Mesures conformes aux recommandations de sant√© publique et de voisinage.\n\n### Signature du Bruit: Dynamique & Monotonie\n\nCe graphique qualifie la **nature de la source sonore** via l'indice de monotonie (L10 - L90).\n\n- **Stable (< 5dB)** : Le bruit est constant et monotone (Signature typique d'une **Pompe √† Chaleur** ou VMC).\n- **Fluctuant (5-10dB)** : Bruit d'environnement standard.\n- **Impulsif (> 15dB)** : Bruit irr√©gulier (Passage de voitures, aboiements, travaux).\n\n### Localisation du Capteur\n\nCarte de situation g√©ographique, montrant la position exacte du capteur.\n",
        "mode": "markdown"
      },
      "pluginVersion": "12.3.2",
      "title": "Explications des differentes visualisations",
      "type": "text"
    },
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 93
      },
      "id": 16,
      "panels": [],
      "title": "Surveillance en Temps R√©el et Conformit√©",
      "type": "row"
    },
    {
      "datasource": {
        "type": "influxdb",
        "uid": "P951FEA4DE68E13C5"
      },
      "description": "Affiche le SPL reconstruit sur des fen√™tres de 30s √† partir des mesures: conversion dB‚Üí√©nergie, agr√©gation en √©nergie, puis reconversion en dB. La courbe est compar√©e √† une limite r√©glementaire dynamique (40/45/50 dB) calcul√©e √† partir de l‚Äôheure locale. NOTE: Cette visualisation applique une moyenne mobile exponentielle (n=30) pour lisser les courbes et faciliter la lecture. Pour une expertise acoustique stricte, il est recommand√© d'analyser les valeurs brutes.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "fixedColor": "green",
            "mode": "fixed",
            "seriesBy": "last"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "smooth",
            "lineStyle": {
              "fill": "solid"
            },
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "showValues": false,
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "displayName": "Niveau Sonore Leq (${__field.labels.frequency_weighting}, $interval)",
          "fieldMinMax": false,
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "dark-green",
                "value": 0
              }
            ]
          },
          "unit": "dB"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "leq_excess"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "dark-red",
                  "mode": "fixed"
                }
              },
              {
                "id": "custom.fillOpacity",
                "value": 20
              },
              {
                "id": "custom.hideFrom",
                "value": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byFrameRefID",
              "options": "Seuil L√©gal"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "#808080bf",
                  "mode": "fixed"
                }
              },
              {
                "id": "custom.lineStyle",
                "value": {
                  "dash": [10, 10],
                  "fill": "dash"
                }
              },
              {
                "id": "displayName",
                "value": "Seuil L√©gal SPL"
              },
              {
                "id": "custom.fillOpacity",
                "value": 0
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "leq_ok"
            },
            "properties": [
              {
                "id": "custom.fillOpacity",
                "value": 20
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "depassement"
            },
            "properties": [
              {
                "id": "custom.hideFrom",
                "value": {
                  "legend": true,
                  "tooltip": false,
                  "viz": true
                }
              },
              {
                "id": "displayName",
                "value": "Depassement"
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 15,
        "w": 24,
        "x": 0,
        "y": 94
      },
      "id": 1,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "hideZeros": false,
          "mode": "multi",
          "sort": "none"
        }
      },
      "pluginVersion": "12.3.2",
      "targets": [
        {
          "datasource": {
            "type": "influxdb",
            "uid": "P951FEA4DE68E13C5"
          },
          "hide": false,
          "query": "import \"date\"\nimport \"timezone\"\nimport \"math\"\n\noption location = timezone.location(name: \"Europe/Brussels\")\n\n// 1. R√©cup√©ration et calcul du Leq (Moyenne √©nerg√©tique)\nsourceData = from(bucket: \"default\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"dt8852\" and r._field == \"spl\" and r.frequency_weighting == \"dB(A)\" and exists r.time_weighting)\n  |> map(fn: (r) => ({ r with _value: math.pow(x: 10.0, y: r._value / 10.0) }))\n  |> aggregateWindow(\n        every: ${interval},\n        fn: mean,\n        createEmpty: false\n     )\n  |> aggregateWindow(\n        every: v.windowPeriod,\n        fn: mean,\n        createEmpty: false\n     )\n  |> map(fn: (r) => ({ r with _value: 10.0 * math.log10(x: r._value) }))\n\nsourceData\n  |> map(fn: (r) => {\n        h = date.hour(t: r._time)\n        limitValue =\n          if h >= 7 and h < 19 then 50.0\n          else if (h >= 6 and h < 7) or (h >= 19 and h < 22) then 45.0\n          else 40.0\n        \n        return {\n            _time: r._time,\n            leq_ok: if r._value <= limitValue then r._value else float(v: \"NaN\"),\n            leq_excess: if r._value > limitValue then r._value else float(v: \"NaN\"),\n            depassement: if r._value > limitValue then r._value - limitValue else 0.0,\n            time_weighting: r.time_weighting,\n            frequency_weighting: r.frequency_weighting\n        }\n  })\n  |> yield(name: \"results\")",
          "refId": "A"
        },
        {
          "datasource": {
            "type": "influxdb",
            "uid": "P951FEA4DE68E13C5"
          },
          "hide": false,
          "query": "import \"date\"\nimport \"timezone\"\n\noption location = timezone.location(name: \"Europe/Brussels\")\n\nfrom(bucket: \"default\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"dt8852\" and r._field == \"spl\")\n  |> aggregateWindow(every: v.windowPeriod, fn: first)\n  |> map(fn: (r) => {\n      h = date.hour(t: r._time)\n      return {\n          _time: r._time,\n          _limit: if h >= 7 and h < 19 then 50.0 \n                  else if h == 6 or (h >= 19 and h < 22) then 45.0 \n                  else 40.0\n      }\n  })",
          "refId": "Seuil L√©gal"
        }
      ],
      "title": "Vue en Temps R√©el",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "influxdb",
        "uid": "P951FEA4DE68E13C5"
      },
      "description": "Suivi en temps r√©el du d√©passement des limites acoustiques r√©glementaires (50/45/40 dB) avec d√©tection automatique des p√©riodes Jour, Aube, Soir et Nuit.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "fixedColor": "dark-red",
            "mode": "fixed"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 50,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "smooth",
            "lineStyle": {
              "fill": "solid"
            },
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "showValues": false,
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "dB"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "seuil_legal"
            },
            "properties": [
              {
                "id": "custom.hideFrom",
                "value": {
                  "legend": true,
                  "tooltip": false,
                  "viz": false
                }
              },
              {
                "id": "custom.fillOpacity",
                "value": 0
              },
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    {
                      "color": "green",
                      "value": 0
                    },
                    {
                      "color": "dark-orange",
                      "value": 45
                    },
                    {
                      "color": "dark-red",
                      "value": 50
                    }
                  ]
                }
              },
              {
                "id": "color",
                "value": {
                  "mode": "thresholds",
                  "seriesBy": "last"
                }
              },
              {
                "id": "custom.lineStyle",
                "value": {
                  "dash": [10, 10],
                  "fill": "dash"
                }
              },
              {
                "id": "custom.hideFrom",
                "value": {
                  "legend": true,
                  "tooltip": false,
                  "viz": true
                }
              },
              {
                "id": "displayName",
                "value": "Seuil L√©gal (dB(A) SPL)"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "niveau_reel"
            },
            "properties": [
              {
                "id": "custom.hideFrom",
                "value": {
                  "legend": true,
                  "tooltip": false,
                  "viz": true
                }
              },
              {
                "id": "displayName",
                "value": "Niveau Sonore Brut (dB(A) SPL)"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "_value"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "D√©passement"
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 11,
        "w": 24,
        "x": 0,
        "y": 109
      },
      "id": 23,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "hideZeros": false,
          "mode": "multi",
          "sort": "none"
        }
      },
      "pluginVersion": "12.3.2",
      "targets": [
        {
          "query": "import \"math\"\nimport \"timezone\"\nimport \"date\"\n\noption location = timezone.location(name: \"Europe/Brussels\")\n\nsourceData = from(bucket: \"default\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"dt8852\" and r._field == \"spl\" and r.frequency_weighting == \"dB(A)\" and exists r.time_weighting)\n  |> map(fn: (r) => ({ r with _value: math.pow(x: 10.0, y: r._value / 10.0) }))\n  |> aggregateWindow(\n        every: ${interval},\n        fn: mean,\n        createEmpty: false\n     )\n  |> aggregateWindow(\n        every: v.windowPeriod,\n        fn: mean,\n        createEmpty: false\n     )\n  |> map(fn: (r) => ({ r with _value: 10.0 * math.log10(x: r._value) }))\n  // 3. Calcul des limites horaires et du d√©passement\n  |> map(fn: (r) => {\n      h = date.hour(t: r._time)\n      \n      // Seuils r√©glementaires (50 / 45 / 40 dB)\n      limite = if h >= 7 and h < 19 then 50.0 \n               else if (h >= 6 and h < 7) or (h >= 19 and h < 22) then 45.0 \n               else 40.0\n      \n      // Calcul du d√©passement\n      diff = if r._value > limite then r._value - limite else 0.0\n      \n      return {\n          _time: r._time,\n          _value: diff,\n          _field: \"D√©passement\",\n          niveau_reel: r._value,\n          seuil_legal: limite\n      }\n  })\n  \n  // 4. Envoi des donn√©es vers Grafana\n  |> yield(name: \"depassement_acoustique\")",
          "refId": "A"
        }
      ],
      "title": "Analyse des √âmergences : Conformit√© aux Seuils L√©gaux",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "influxdb",
        "uid": "P951FEA4DE68E13C5"
      },
      "description": "Affichage en temps r√©el de la temp√©rature mesur√©e par la sonde USB externe.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "smooth",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "showValues": false,
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "displayName": "Temp√©rature Ext√©rieure",
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "celsius"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 120
      },
      "id": 31,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "hideZeros": false,
          "mode": "single",
          "sort": "none"
        }
      },
      "pluginVersion": "12.3.2",
      "targets": [
        {
          "query": "import \"timezone\"\nimport \"date\"\nimport \"math\"\n\noption location = timezone.location(name: \"Europe/Brussels\")\n\nfrom(bucket: \"usb_temperature\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r[\"_field\"] == \"temp_external\")\n  |> aggregateWindow(every: 3m, fn: median, createEmpty: false)  \n  |> aggregateWindow(every: v.windowPeriod, fn: median, createEmpty: false)\n  |> map(fn: (r) => ({\n      r with \n      _value: math.round(x: r._value * 2.0) / 2.0\n    }))\n  |> keep(columns: [\"_time\", \"_value\"])",
          "refId": "A"
        }
      ],
      "title": "Temp√©rature Ext√©rieure",
      "type": "timeseries"
    },
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 128
      },
      "id": 20,
      "panels": [],
      "title": "Indicateurs Experts",
      "type": "row"
    },
    {
      "datasource": {
        "type": "influxdb",
        "uid": "P951FEA4DE68E13C5"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "fixed"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "smooth",
            "lineStyle": {
              "fill": "solid"
            },
            "lineWidth": 5,
            "pointSize": 10,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "never",
            "showValues": false,
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              }
            ]
          },
          "unit": "dB"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "seuil_legal"
            },
            "properties": [
              {
                "id": "custom.lineStyle",
                "value": {
                  "dash": [10, 10],
                  "fill": "dash"
                }
              },
              {
                "id": "color",
                "value": {
                  "fixedColor": "#ccccccbf",
                  "mode": "fixed"
                }
              },
              {
                "id": "displayName",
                "value": "Seuil L√©gal"
              },
              {
                "id": "custom.lineWidth",
                "value": 1
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "L10_exced"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "#c4162a40",
                  "mode": "fixed"
                }
              },
              {
                "id": "displayName",
                "value": "Niveau Sonore - L10 SPL (${__field.labels.frequency_weighting}, ${__field.labels.time_weighting})"
              },
              {
                "id": "custom.lineStyle",
                "value": {
                  "dash": [0, 10],
                  "fill": "dot"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "L10_ok"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "#37872d40",
                  "mode": "fixed"
                }
              },
              {
                "id": "displayName",
                "value": "Niveau Sonore - L10 SPL (${__field.labels.frequency_weighting}, ${__field.labels.time_weighting})"
              },
              {
                "id": "custom.lineStyle",
                "value": {
                  "dash": [0, 10],
                  "fill": "dot"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "L50_ok"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "dark-green",
                  "mode": "fixed"
                }
              },
              {
                "id": "displayName",
                "value": "Niveau Sonore - L50 SPL (${__field.labels.frequency_weighting}, ${__field.labels.time_weighting})"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "L90_exced"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "#c4162a40",
                  "mode": "fixed"
                }
              },
              {
                "id": "displayName",
                "value": "Niveau Sonore - L90 SPL (${__field.labels.frequency_weighting}, ${__field.labels.time_weighting})"
              },
              {
                "id": "custom.lineStyle",
                "value": {
                  "dash": [0, 10],
                  "fill": "dot"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "L90_ok"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "#37872d40",
                  "mode": "fixed"
                }
              },
              {
                "id": "displayName",
                "value": "Niveau Sonore - L90 SPL (${__field.labels.frequency_weighting}, ${__field.labels.time_weighting})"
              },
              {
                "id": "custom.lineStyle",
                "value": {
                  "dash": [0, 10],
                  "fill": "dot"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "L50_exced"
            },
            "properties": [
              {
                "id": "custom.lineStyle"
              },
              {
                "id": "color",
                "value": {
                  "fixedColor": "dark-red",
                  "mode": "fixed"
                }
              },
              {
                "id": "displayName",
                "value": "Niveau Sonore - L50 SPL (${__field.labels.frequency_weighting}, ${__field.labels.time_weighting})"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "depassement"
            },
            "properties": [
              {
                "id": "custom.hideFrom",
                "value": {
                  "legend": true,
                  "tooltip": false,
                  "viz": true
                }
              },
              {
                "id": "displayName",
                "value": "D√©passement"
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 11,
        "w": 24,
        "x": 0,
        "y": 129
      },
      "id": 28,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "hideZeros": false,
          "mode": "multi",
          "sort": "none"
        }
      },
      "pluginVersion": "12.3.2",
      "targets": [
        {
          "query": "import \"date\"\nimport \"timezone\"\n\n// --- CONFIGURATION ---\noption location = timezone.location(name: \"Europe/Brussels\")\n\nactualInterval = if int(v: v.windowPeriod) < int(v: 15s) then 15s else v.windowPeriod\n\nsource = from(bucket: \"default\")\n    |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n    |> filter(fn: (r) => r._measurement == \"dt8852\" and r._field == \"spl\" and r.frequency_weighting == \"dB(A)\")\n    |> filter(fn: (r) => exists r._value and exists r.time_weighting)\n    |> aggregateWindow(\n      every: v.windowPeriod,\n      fn: median,\n      createEmpty: false\n    )\n    |> keep(columns: [\"_time\", \"_value\", \"frequency_weighting\", \"time_weighting\"])\n\nl10 = source \n    |> aggregateWindow(every: actualInterval, fn: (column, tables=<-) => tables |> quantile(q: 0.90)) \n    |> map(fn: (r) => ({ r with _field: \"L10\" }))\n\nl50 = source \n    |> aggregateWindow(every: actualInterval, fn: (column, tables=<-) => tables |> quantile(q: 0.50)) \n    |> map(fn: (r) => ({ r with _field: \"L50\" }))\n\nl90 = source \n    |> aggregateWindow(every: actualInterval, fn: (column, tables=<-) => tables |> quantile(q: 0.10)) \n    |> map(fn: (r) => ({ r with _field: \"L90\" }))\n\nspl_raw = source \n    |> aggregateWindow(every: actualInterval, fn: mean) \n    |> map(fn: (r) => ({ r with _field: \"SPL_raw\" }))\n\n// 3. ASSEMBLAGE\nunion(tables: [l10, l50, l90, spl_raw])\n    |> pivot(rowKey: [\"_time\", \"frequency_weighting\", \"time_weighting\"], columnKey: [\"_field\"], valueColumn: \"_value\")\n    |> map(fn: (r) => {\n        h = date.hour(t: r._time)\n        // Logique de seuil r√©glementaire\n        limit = if h >= 7 and h < 19 then 50.0\n                else if (h >= 6 and h < 7) or (h >= 19 and h < 22) then 45.0\n                else 40.0\n        \n        nan = float(v: \"NaN\")\n\n        // S√©curisation des valeurs (cast en float pour √©viter les erreurs \"invalid\")\n        val_spl = if exists r.SPL_raw then float(v: r.SPL_raw) else 0.0\n        val_l10 = if exists r.L10 then float(v: r.L10) else nan\n        val_l50 = if exists r.L50 then float(v: r.L50) else nan\n        val_l90 = if exists r.L90 then float(v: r.L90) else nan\n\n        return {\n            _time: r._time,\n            frequency_weighting: r.frequency_weighting,\n            time_weighting: r.time_weighting,\n            seuil_legal: limit,\n            \n            // Si SPL_raw > limit, on renvoie la diff√©rence, sinon 0\n            depassement: if val_spl > limit then val_spl - limit else 0.0,\n\n            // R√©partition pour coloration Grafana\n            L10_ok:     if val_l10 <= limit then val_l10 else nan,\n            L10_exced:  if val_l10 > limit  then val_l10 else nan,\n            L50_ok:     if val_l50 <= limit then val_l50 else nan,\n            L50_exced:  if val_l50 > limit  then val_l50 else nan,\n            L90_ok:     if val_l90 <= limit then val_l90 else nan,\n            L90_exced:  if val_l90 > limit  then val_l90 else nan\n        }\n    })\n    |> yield(name: \"acoustic_data\")",
          "refId": "A"
        }
      ],
      "title": "Indicateurs de Pression Acoustique",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "influxdb",
        "uid": "P951FEA4DE68E13C5"
      },
      "description": "Synth√®se avanc√©e de l'environnement sonore et analyse statistique instantan√©e des indicateurs acoustiques. Ce panneau pr√©sente une vue exhaustive de la pollution sonore sur la p√©riode s√©lectionn√©e en combinant mesures √©nerg√©tiques et distribution centile. Il calcule le niveau moyen Leq ainsi que l'indice de g√™ne global Lden, lequel int√®gre les p√©nalit√©s r√©glementaires pour le soir (+5 dB) et la nuit (+10 dB) conform√©ment aux normes d'√©valuation de l'exposition au bruit. L'analyse statistique par centiles permet de caract√©riser pr√©cis√©ment la nature du signal : le  L10 (niveau d√©pass√© pendant 10 % de la p√©riode) met en √©vidence les √©v√©nements sonores ponctuels et les pics de pollution, le L50 (niveau m√©dian d√©pass√© 50 % du temps) d√©finit la tendance centrale du climat sonore, tandis que le L90 (niveau d√©pass√© 90 % du temps) permet d'isoler le bruit de fond permanent en l'absence de sources intermittentes. Enfin, le panneau affiche le niveau d'exposition unique (SEL) et les extrema (Lmax/Lmin) pour offrir une lecture compl√®te de la dynamique acoustique du site.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "fixedColor": "text",
            "mode": "fixed"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              }
            ]
          },
          "unit": "dB"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "L10 {frequency_weighting=\"dB(A)\", time_weighting=\"Slow\"}"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "L10 (${__field.labels.frequency_weighting}, $__interval)"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "L50 {frequency_weighting=\"dB(A)\", time_weighting=\"Slow\"}"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "L50 (${__field.labels.frequency_weighting}, $__interval)"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "L90 {frequency_weighting=\"dB(A)\", time_weighting=\"Slow\"}"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "L90 (${__field.labels.frequency_weighting}, $__interval)"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Leq {frequency_weighting=\"dB(A)\", time_weighting=\"Slow\"}"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Leq (${__field.labels.frequency_weighting}, $__interval)"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Lmax {frequency_weighting=\"dB(A)\", time_weighting=\"Slow\"}"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Lmax (${__field.labels.frequency_weighting})"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Lmin {frequency_weighting=\"dB(A)\", time_weighting=\"Slow\"}"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Lmin (${__field.labels.frequency_weighting})"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "SEL {frequency_weighting=\"dB(A)\", time_weighting=\"Slow\"}"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "SEL (${__field.labels.frequency_weighting}, $__interval)"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Lden {frequency_weighting=\"dB(A)\", time_weighting=\"Slow\"}"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Lden (${__field.labels.frequency_weighting}, $__interval)"
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 4,
        "w": 24,
        "x": 0,
        "y": 140
      },
      "id": 27,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "percentChangeColorMode": "standard",
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        },
        "showPercentChange": false,
        "text": {},
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "12.3.2",
      "targets": [
        {
          "query": "import \"math\"\nimport \"date\"\nimport \"timezone\"\n\noption location = timezone.location(name: \"Europe/Brussels\")\n\n// --- 1. CONFIGURATION ---\nP_EVENING_DB = 5.0\nP_NIGHT_DB = 10.0\n\nFACTOR_DAY = 1.0\nFACTOR_EVENING = math.pow(x: 10.0, y: P_EVENING_DB / 10.0)\nFACTOR_NIGHT = math.pow(x: 10.0, y: P_NIGHT_DB / 10.0)\n\ntoDB = (val) => if exists val and val > 0.0 then 10.0 * math.log10(x: val) else 0.0\n\nT_START = v.timeRangeStart\nT_STOP = v.timeRangeStop\n\n// --- 2. PR√âPARATION DES DONN√âES √âNERG√âTIQUES (Base de calcul) ---\nraw_energy = from(bucket: \"default\")\n  |> range(start: T_START, stop: T_STOP)\n  |> filter(fn: (r) => r._measurement == \"dt8852\" and r._field == \"spl\" and r.frequency_weighting == \"dB(A)\" and exists r.time_weighting)\n  // On convertit imm√©diatement en √©nergie pour travailler proprement\n  |> map(fn: (r) => ({ r with _value: math.pow(x: 10.0, y: r._value / 10.0) }))\n\n// On cr√©e une base agr√©g√©e (ex: par minute) pour stabiliser les calculs si la p√©riode est longue\nbase_1m = raw_energy\n  |> aggregateWindow(every: 1m, fn: mean, createEmpty: false) \n\n// --- 3. BRANCHE INDICATEURS SANS P√âNALIT√â (Leq, L10, L50, L90, Max, Min) ---\nstats_base = base_1m \n  |> group(columns: [\"frequency_weighting\", \"time_weighting\"])\n\nlmin = stats_base |> min() |> set(key: \"_field\", value: \"lmin\")\nlmax = stats_base |> max() |> set(key: \"_field\", value: \"lmax\")\nl10  = stats_base |> quantile(q: 0.90) |> set(key: \"_field\", value: \"l10\")\nl50  = stats_base |> quantile(q: 0.50) |> set(key: \"_field\", value: \"l50\")\nl90  = stats_base |> quantile(q: 0.10) |> set(key: \"_field\", value: \"l90\")\nleq  = stats_base |> mean()     |> set(key: \"_field\", value: \"energy_avg\")\n\n// --- 4. BRANCHE LDEN (AVEC P√âNALIT√âS) ---\n// On applique la p√©nalit√© sur chaque segment de 1m AVANT de faire la moyenne globale\nlden_energy = base_1m\n  |> map(fn: (r) => {\n        h = date.hour(t: r._time)\n        penalty_factor = if h >= 7 and h < 19 then FACTOR_DAY\n                         else if h >= 19 and h < 23 then FACTOR_EVENING \n                         else FACTOR_NIGHT\n        return { r with _value: r._value * penalty_factor }\n    })\n  |> group(columns: [\"frequency_weighting\", \"time_weighting\"])\n  |> mean()\n  |> set(key: \"_field\", value: \"energy_lden_avg\")\n\n// --- 5. ASSEMBLAGE FINAL ---\nduration_sec = float(v: int(v: T_STOP) - int(v: T_START)) / 1000000000.0\n\nunion(tables: [lmin, lmax, l10, l50, l90, leq, lden_energy])\n    |> pivot(rowKey:[\"frequency_weighting\", \"time_weighting\"], columnKey: [\"_field\"], valueColumn: \"_value\")\n    |> map(fn: (r) => {\n        l_eq = toDB(val: r.energy_avg)\n        l_den = toDB(val: r.energy_lden_avg)\n        l_sel = l_eq + (10.0 * math.log10(x: if duration_sec > 0.0 then duration_sec else 1.0))\n        \n        return {\n            _time: T_STOP,\n            frequency_weighting: r.frequency_weighting,\n            time_weighting: r.time_weighting,\n            \"Leq\": math.round(x: l_eq * 10.0) / 10.0,\n            \"Lden\": math.round(x: l_den * 10.0) / 10.0,\n            \"L10\": math.round(x: toDB(val: r.l10) * 10.0) / 10.0,\n            \"L50\": math.round(x: toDB(val: r.l50) * 10.0) / 10.0,\n            \"L90\": math.round(x: toDB(val: r.l90) * 10.0) / 10.0,\n            \"Lmax\": math.round(x: toDB(val: r.lmax) * 10.0) / 10.0,\n            \"Lmin\": math.round(x: toDB(val: r.lmin) * 10.0) / 10.0,\n            \"SEL\": math.round(x: l_sel * 10.0) / 10.0\n        }\n    })\n    |> keep(columns: [\"_time\", \"frequency_weighting\", \"time_weighting\", \"Leq\", \"Lden\", \"L10\", \"L50\", \"L90\", \"Lmax\", \"Lmin\", \"SEL\"])\n    |> yield(name: \"acoustic_indicators\")",
          "refId": "A"
        }
      ],
      "title": "Synth√®se avanc√©e de l'environnement sonore et analyse statistique instantan√©e des indicateurs acoustiques.",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "influxdb",
        "uid": "P951FEA4DE68E13C5"
      },
      "description": "Tableau de bord consolid√© des niveaux de pression acoustique pond√©r√©s A, agr√©g√©s par p√©riodes de 24 heures. Ce rapport regroupe les indicateurs r√©glementaires d'exposition globale (Lden), les moyennes √©nerg√©tiques de jour (Lday, 07h-22h) et de nuit (Lnight, 22h-07h), la distribution statistique du bruit (L10, L50, L90) ainsi que les extr√™mes de la journ√©e (Lmin, Lmax).",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisGridShow": true,
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "smooth",
            "lineWidth": 1,
            "pointSize": 8,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "always",
            "showValues": false,
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "fieldMinMax": false,
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              }
            ]
          },
          "unit": "dB"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Lden"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Lden (${__field.labels.frequency_weighting}, $__interval)"
              },
              {
                "id": "custom.lineWidth",
                "value": 2
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "L10"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "L10 (${__field.labels.frequency_weighting}, $__interval)"
              },
              {
                "id": "custom.lineStyle",
                "value": {
                  "dash": [50, 10],
                  "fill": "dash"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "L50"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "L50 (${__field.labels.frequency_weighting}, $__interval)"
              },
              {
                "id": "custom.lineStyle",
                "value": {
                  "dash": [50, 10],
                  "fill": "dash"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "L90"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "L90 (${__field.labels.frequency_weighting}, $__interval)"
              },
              {
                "id": "custom.lineStyle",
                "value": {
                  "dash": [50, 10],
                  "fill": "dash"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Lmax"
            },
            "properties": [
              {
                "id": "custom.lineStyle",
                "value": {
                  "dash": [10, 10],
                  "fill": "dash"
                }
              },
              {
                "id": "displayName",
                "value": "Lmax (${__field.labels.frequency_weighting})"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Lmin"
            },
            "properties": [
              {
                "id": "custom.lineStyle",
                "value": {
                  "dash": [10, 10],
                  "fill": "dash"
                }
              },
              {
                "id": "displayName",
                "value": "Lmin (${__field.labels.frequency_weighting})"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Lday"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Lday (7h-22h) (${__field.labels.frequency_weighting}, $__interval)"
              },
              {
                "id": "custom.lineStyle",
                "value": {
                  "fill": "solid"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Lnight"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Lnight (22h-7h) (${__field.labels.frequency_weighting}, $__interval)"
              },
              {
                "id": "custom.lineStyle",
                "value": {
                  "fill": "solid"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Leq"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Leq (${__field.labels.frequency_weighting}, $__interval)"
              },
              {
                "id": "custom.lineWidth",
                "value": 2
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "_time"
            },
            "properties": [
              {
                "id": "unit",
                "value": "time:dddd DD-MM-YYYY"
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 12,
        "w": 24,
        "x": 0,
        "y": 144
      },
      "id": 30,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "timezone": [""],
        "tooltip": {
          "hideZeros": false,
          "mode": "multi",
          "sort": "desc"
        }
      },
      "pluginVersion": "12.3.2",
      "targets": [
        {
          "query": "import \"date\"\nimport \"math\"\nimport \"timezone\"\n\noption location = timezone.location(name: \"Europe/Brussels\")\n\nfullRangeStart = date.add(d: 1d, to: date.truncate(t: v.timeRangeStart, unit: 1d))\nfullRangeStop = v.timeRangeStop\n\nbase1m = from(bucket: \"default\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"dt8852\" and r._field == \"spl\" and r.frequency_weighting == \"dB(A)\" and exists r.time_weighting)\n  |> map(fn: (r) => ({ r with _value: math.pow(x: 10.0, y: r._value / 10.0) }))\n  |> aggregateWindow(\n        every: v.windowPeriod,\n        fn: mean,\n        createEmpty: false\n     )\n  |> map(fn: (r) => ({ r with _value: 10.0 * math.log10(x: r._value) }))\n\n// 2. PR√âPARATION √âNERG√âTIQUE\nenergy_base = base1m\n  |> map(fn: (r) => ({ r with energy: math.pow(x: 10.0, y: float(v: r._value) / 10.0) }))\n\n// --- NOUVEL INDICATEUR : Leq (24h) ---\n// Moyenne √©nerg√©tique pure sur toute la journ√©e\nleq = energy_base\n  |> aggregateWindow(every: 1d, fn: mean, column: \"energy\", timeSrc: \"_start\")\n  |> map(fn: (r) => ({ r with _field: \"Leq\", _value: 10.0 * math.log10(x: r.energy) }))\n\n// --- INDICATEURS OMS / EUROPE ---\nlday = energy_base\n  |> filter(fn: (r) => {\n      h = date.hour(t: r._time)\n      return h >= 7 and h < 22\n  })\n  |> aggregateWindow(every: 1d, fn: mean, column: \"energy\", timeSrc: \"_start\")\n  |> map(fn: (r) => ({ r with _field: \"Lday\", _value: 10.0 * math.log10(x: r.energy) }))\n\nlnight = energy_base\n  |> filter(fn: (r) => {\n      h = date.hour(t: r._time)\n      return h >= 22 or h < 7\n  })\n  |> aggregateWindow(every: 1d, fn: mean, column: \"energy\", timeSrc: \"_start\")\n  |> map(fn: (r) => ({ r with _field: \"Lnight\", _value: 10.0 * math.log10(x: r.energy) }))\n\nlden = energy_base\n  |> map(fn: (r) => {\n      h = date.hour(t: r._time)\n      penalty = if h >= 19 and h < 23 then 5.0 \n                else if h >= 23 or h < 7 then 10.0 \n                else 0.0\n      return { r with energy_weighted: r.energy * math.pow(x: 10.0, y: penalty / 10.0) }\n  })\n  |> aggregateWindow(every: 1d, fn: mean, column: \"energy_weighted\", timeSrc: \"_start\")\n  |> map(fn: (r) => ({ r with _field: \"Lden\", _value: 10.0 * math.log10(x: r.energy_weighted) }))\n\n// --- STATISTIQUES CLASSIQUES ---\nlmax = base1m |> aggregateWindow(timeSrc: \"_start\", every: 1d, fn: max) |> map(fn: (r) => ({ r with _field: \"Lmax\" }))\nlmin = base1m |> aggregateWindow(timeSrc: \"_start\", every: 1d, fn: min) |> map(fn: (r) => ({ r with _field: \"Lmin\" }))\nl10 = base1m |> aggregateWindow(timeSrc: \"_start\", every: 1d, fn: (column, tables=<-) => tables |> quantile(q: 0.90)) |> map(fn: (r) => ({ r with _field: \"L10\" }))\nl50 = base1m |> aggregateWindow(timeSrc: \"_start\", every: 1d, fn: (column, tables=<-) => tables |> quantile(q: 0.50)) |> map(fn: (r) => ({ r with _field: \"L50\" }))\nl90 = base1m |> aggregateWindow(timeSrc: \"_start\", every: 1d, fn: (column, tables=<-) => tables |> quantile(q: 0.10)) |> map(fn: (r) => ({ r with _field: \"L90\" }))\n\n// 5. ASSEMBLAGE FINAL\nunion(tables: [l10, l50, l90, lmin, lmax, lden, lday, lnight, leq])\n  |> pivot(rowKey: [\"_time\", \"frequency_weighting\", \"time_weighting\"], columnKey: [\"_field\"], valueColumn: \"_value\")\n",
          "refId": "A"
        }
      ],
      "timeFrom": "now-10d",
      "title": "Synth√®se avanc√©e de l'environnement sonore et analyse statistique quotidenne des indicateurs acoustiques.",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "influxdb",
        "uid": "P951FEA4DE68E13C5"
      },
      "description": "Ce graphique pr√©sente le pourcentage de temps durant lequel les niveaux sonores ont d√©pass√© les seuils l√©gaux par p√©riode de 24h. Les calculs sont bas√©s sur les limites r√©glementaires : Jour (07h-19h) : 50 dB(A), Aube/Soir (06h-07h, 19h-22h) : 45 dB(A), et Nuit (22h-06h) : 40 dB(A). Une valeur de 100% indique que le bruit a √©t√© continuellement au-dessus de la limite pour la p√©riode donn√©e.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "axisSoftMax": 100,
            "fillOpacity": 80,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineWidth": 1,
            "scaleDistribution": {
              "type": "linear"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "yellow",
                "value": 10
              },
              {
                "color": "light-orange",
                "value": 20
              },
              {
                "color": "dark-orange",
                "value": 30
              },
              {
                "color": "semi-dark-red",
                "value": 40
              },
              {
                "color": "dark-red",
                "value": 50
              }
            ]
          },
          "unit": "time:dddd DD-MM-YYYY"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "1. Jour (07h-19h)"
            },
            "properties": [
              {
                "id": "unit",
                "value": "percent"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "2. Aube/Soir (06h-07h, 19h-22h)"
            },
            "properties": [
              {
                "id": "unit",
                "value": "percent"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "3. Nuit (22h-06h)"
            },
            "properties": [
              {
                "id": "unit",
                "value": "percent"
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 11,
        "w": 24,
        "x": 0,
        "y": 156
      },
      "id": 33,
      "options": {
        "barRadius": 0,
        "barWidth": 0.97,
        "fullHighlight": false,
        "groupWidth": 0.7,
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "orientation": "auto",
        "showValue": "auto",
        "stacking": "none",
        "tooltip": {
          "hideZeros": false,
          "mode": "single",
          "sort": "none"
        },
        "xField": "_time",
        "xTickLabelRotation": 0,
        "xTickLabelSpacing": 0
      },
      "pluginVersion": "12.3.2",
      "targets": [
        {
          "datasource": {
            "type": "influxdb",
            "uid": "P951FEA4DE68E13C5"
          },
          "hide": false,
          "query": "import \"timezone\"\nimport \"date\"\n\noption location = timezone.location(name: \"Europe/Brussels\")\n\nfullRangeStart = date.add(d: 1d, to: date.truncate(t: v.timeRangeStart, unit: 1d))\nfullRangeStop = date.truncate(t: now(), unit: 1d)\n\nfrom(bucket: \"default\")\n  |> range(start: fullRangeStart, stop: fullRangeStop)\n  |> filter(fn: (r) => r._measurement == \"dt8852\" and r._field == \"spl\" and r.frequency_weighting == \"dB(A)\" and exists r.time_weighting and exists r._value)\n  |> aggregateWindow(every: 1m, fn: median) \n    |> map(fn: (r) => {\n      h = date.hour(t: r._time)\n      info = if h >= 7 and h < 19 then \n                {s: \"1. Jour (07h-19h)\", l: 50.0}\n             else if (h >= 6 and h < 7) or (h >= 19 and h < 22) then \n                {s: \"2. Aube/Soir (06h-07h, 19h-22h)\", l: 45.0}\n             else \n                {s: \"3. Nuit (22h-06h)\", l: 40.0}\n      \n      return { r with \n        tranche: info.s, \n        _value: if r._value > info.l then 1.0 else 0.0 \n      }\n  })\n  |> group(columns: [\"tranche\"])\n  |> aggregateWindow(every: 1d, fn: mean, column: \"_value\", timeSrc: \"_start\")\n  |> map(fn: (r) => ({ _time: r._time, tranche: r.tranche, pct: r._value * 100.0 }))\n  |> group() \n  |> pivot(rowKey:[\"_time\"], columnKey: [\"tranche\"], valueColumn: \"pct\")\n  |> yield(name: \"depassement_legal\")",
          "refId": "A"
        }
      ],
      "timeFrom": "now-10d",
      "title": "Suivi Journalier de la Conformit√© Acoustique",
      "type": "barchart"
    },
    {
      "datasource": {
        "type": "influxdb",
        "uid": "P951FEA4DE68E13C5"
      },
      "description": "Ce graphique de corr√©lation analyse la distribution de chaque mesure acoustique sur un cycle de 24 heures (axe vertical), ind√©pendamment du jour calendaire. Il permet d‚Äôisoler visuellement les nuisances m√©caniques cycliques (r√©currences) des bruits al√©atoires de l'environnement, tout en mettant en relief la s√©v√©rit√© des infractions par rapport aux seuils l√©gaux.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "fixedColor": "#78787880",
            "mode": "continuous-GrYlRd",
            "seriesBy": "last"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "Niveau de Pression Sonore (dB(A))",
            "axisPlacement": "auto",
            "axisSoftMin": 35,
            "fillOpacity": 50,
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "pointShape": "circle",
            "pointSize": {
              "fixed": 1,
              "max": 50,
              "min": 1
            },
            "pointStrokeWidth": 1,
            "scaleDistribution": {
              "type": "linear"
            },
            "show": "points"
          },
          "fieldMinMax": false,
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "light-green",
                "value": 0
              }
            ]
          },
          "unit": "dB"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "heure"
            },
            "properties": [
              {
                "id": "custom.axisSoftMax",
                "value": 24
              },
              {
                "id": "custom.axisSoftMin",
                "value": 0
              },
              {
                "id": "decimals",
                "value": 0
              },
              {
                "id": "custom.axisLabel",
                "value": "Heure de la journ√©e"
              },
              {
                "id": "unit",
                "value": ""
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "severite"
            },
            "properties": [
              {
                "id": "custom.hideFrom",
                "value": {
                  "legend": true,
                  "tooltip": false,
                  "viz": true
                }
              },
              {
                "id": "displayName",
                "value": "D√©passement"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "_time"
            },
            "properties": [
              {
                "id": "custom.hideFrom",
                "value": {
                  "legend": true,
                  "tooltip": true,
                  "viz": true
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "heure"
            },
            "properties": [
              {
                "id": "custom.hideFrom",
                "value": {
                  "legend": true,
                  "tooltip": false,
                  "viz": false
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "limit"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Seuil l√©gal"
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 23,
        "w": 24,
        "x": 0,
        "y": 167
      },
      "id": 32,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "mapping": "manual",
        "series": [
          {
            "color": {
              "matcher": {
                "id": "byName",
                "options": "severite"
              }
            },
            "frame": {
              "matcher": {
                "id": "byIndex",
                "options": 0
              }
            },
            "size": {
              "matcher": {
                "id": "byName",
                "options": "severite"
              }
            },
            "x": {
              "matcher": {
                "id": "byName",
                "options": "decibels"
              }
            },
            "y": {
              "matcher": {
                "id": "byName",
                "options": "heure"
              }
            }
          }
        ],
        "tooltip": {
          "hideZeros": false,
          "mode": "single",
          "sort": "none"
        }
      },
      "pluginVersion": "12.3.2",
      "targets": [
        {
          "query": "import \"date\"\nimport \"timezone\"\nimport \"math\"\n\noption location = timezone.location(name: \"Europe/Brussels\")\n\n// 1. Calcul de la dur√©e s√©lectionn√©e par lutilisateur\nrangeDuration = uint(v: v.timeRangeStop) - uint(v: v.timeRangeStart)\noneDay = uint(v: 24h)\n\n// 2. D√©finition du point de d√©part dynamique\n// Si la s√©lection est < 24h, on force le d√©but √† minuit aujourdhui\nactualStart = if rangeDuration < oneDay then date.truncate(t: now(), unit: 1d) else v.timeRangeStart\n\n// 3. Calcul de la fen√™tre dagr√©gation dynamique pour √©viter le \"Too many datapoints\"\n// On calcule la dur√©e r√©elle de donn√©es quon va charger\nactualDuration = uint(v: v.timeRangeStop) - uint(v: actualStart)\n// On divise par 1000 pour viser environ 1000 points sur le graphique\ndivisor = uint(v: 1000)\n// On prend le plus grand entre (dur√©e totale / 1000) et la fen√™tre automatique de Grafana\nwindowInNs = if actualDuration / divisor > uint(v: v.windowPeriod) then actualDuration / divisor else uint(v: v.windowPeriod)\ndynamicWindow = duration(v: windowInNs)\n\nfrom(bucket: \"default\")\n  |> range(start: actualStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"dt8852\" and r._field == \"spl\" and r.frequency_weighting == \"dB(A)\")\n  |> aggregateWindow(every: dynamicWindow, fn: median)\n  |> filter(fn: (r) => exists r._value)\n  |> keep(columns: [\"_time\", \"_value\", \"frequency_weighting\", \"time_weighting\"])\n    |> map(fn: (r) => {\n      h = date.hour(t: r._time)\n      m = date.minute(t: r._time)\n      s = date.second(t: r._time)\n      \n      // Formule pour arrondir √† 0.5 pr√®s\n      roundedValue = math.round(x: r._value * 4.0) / 4.0\n\n      // Seuils PAC Wallonie\n      limit = if h >= 7 and h < 19 then 50.0 \n              else if (h >= 6 and h < 7) or (h >= 19 and h < 22) then 45.0 \n              else 40.0\n      \n      // On utilise la valeur arrondie pour calculer la s√©v√©rit√© si on veut de la coh√©rence\n      diff = if roundedValue > limit then roundedValue - limit else 0.0\n\n      return {\n          _time: r._time,\n          decibels: roundedValue,\n          heure: float(v: h) + (float(v: m) / 60.0) + (float(v: s) / 3600.0),\n          limit: limit,\n          severite: diff + 1.0\n      }\n  })\n  |> keep(columns: [\"_time\", \"decibels\", \"heure\", \"severite\", \"limit\"])\n  |> group()",
          "refId": "A"
        }
      ],
      "title": "Analyse de Densit√© : Intensit√© vs Cycle Circadien",
      "type": "xychart"
    },
    {
      "datasource": {
        "type": "influxdb",
        "uid": "P951FEA4DE68E13C5"
      },
      "description": "Calcul de la dynamique du bruit: Diff√©rence entre le niveau de pointe (L10) et le niveau de fond (L90).\n\n- Valeur √©lev√©e (> 15 dB) : Bruit fluctuant, trafic, √©v√©nements ponctuels.\n- Valeur faible (< 5 dB) : Bruit monotone et continu. C'est la signature typique d'une **Pompe √† Chaleur** ou d'une VMC.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "fixedColor": "text",
            "mode": "thresholds",
            "seriesBy": "last"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 100,
            "gradientMode": "opacity",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "smooth",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "showValues": false,
            "spanNulls": true,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "dashed"
            }
          },
          "displayName": "Indice de Monotonie (L10,T - L90,T), (T = ${interval})",
          "fieldMinMax": false,
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "dark-red",
                "value": 0
              }
            ]
          },
          "unit": "dB"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byFrameRefID",
              "options": "B"
            },
            "properties": [
              {
                "id": "mappings",
                "value": [
                  {
                    "options": {
                      "from": 0,
                      "result": {
                        "color": "dark-green",
                        "index": 0,
                        "text": "Stable"
                      },
                      "to": 5
                    },
                    "type": "range"
                  },
                  {
                    "options": {
                      "from": 5,
                      "result": {
                        "color": "dark-orange",
                        "index": 1,
                        "text": "Fluctuant"
                      },
                      "to": 15
                    },
                    "type": "range"
                  },
                  {
                    "options": {
                      "from": 15,
                      "result": {
                        "color": "dark-red",
                        "index": 2,
                        "text": "Hautement variable"
                      },
                      "to": 100
                    },
                    "type": "range"
                  }
                ]
              },
              {
                "id": "custom.hideFrom",
                "value": {
                  "legend": true,
                  "tooltip": false,
                  "viz": true
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 9,
        "w": 24,
        "x": 0,
        "y": 190
      },
      "id": 22,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "hideZeros": false,
          "mode": "multi",
          "sort": "none"
        }
      },
      "pluginVersion": "12.3.2",
      "targets": [
        {
          "hide": false,
          "query": "import \"math\"\nimport \"timezone\"\n\n// Configuration de la zone horaire\noption location = timezone.location(name: \"Europe/Brussels\")\n\nbase = from(bucket: \"default\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"dt8852\" and r._field == \"spl\" and r.frequency_weighting == \"dB(A)\" and exists r._value and exists r.time_weighting)\n  |> keep(columns: [\"_time\", \"_value\", \"frequency_weighting\", \"time_weighting\"])\n\n// 2. Calcul du L10 (Pics sonores) \nl10 = base\n  |> aggregateWindow(\n        every: v.windowPeriod,\n        fn: (column, tables=<-) => tables |> quantile(q: 0.90),\n        createEmpty: false\n     )\n  |> aggregateWindow(\n        every: ${interval},\n        fn: mean,\n        createEmpty: false\n     )\n  |> map(fn: (r) => ({ r with _field: \"l10\" }))\n\n// 3. Calcul du L90 (Bruit de fond)\nl90 = base\n  |> aggregateWindow(\n        every: v.windowPeriod,\n        fn: (column, tables=<-) => tables |> quantile(q: 0.10),\n        createEmpty: false\n     )\n  |> aggregateWindow(\n        every: ${interval},\n        fn: mean,\n        createEmpty: false\n     )\n  |> map(fn: (r) => ({ r with _field: \"l90\" }))\n\n// 4. Fusion et Pivotage s√©curis√©\nunion(tables: [l10, l90])\n  |> pivot(rowKey:[\"_time\", \"frequency_weighting\", \"time_weighting\"], columnKey: [\"_field\"], valueColumn: \"_value\")\n  |> filter(fn: (r) => exists r.l10 and exists r.l90)\n  |> map(fn: (r) => {\n      val_l10 = float(v: r.l10)\n      val_l90 = float(v: r.l90)\n      diff = val_l10 - val_l90\n      \n      return {\n          _time: r._time,\n          frequency_weighting: r.frequency_weighting,\n          time_weighting: r.time_weighting,\n          _field: \"Climat Sonore (L10-L90)\",\n          _value: if diff < 0.0 then 0.0 else diff\n      }\n  })\n  |> yield(name: \"climat_sonore\")",
          "refId": "A"
        }
      ],
      "title": "Signature du Bruit: Dynamique & Monotonie",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "influxdb",
        "uid": "P951FEA4DE68E13C5"
      },
      "description": "Affiche la position du capteur √† partir de coordonn√©es d√©finies dans le tableau de bord (point fixe). Sert √† interpr√©ter les mesures en fonction de l‚Äôenvironnement imm√©diat (obstacles, voisinage, g√©om√©trie des lieux).",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 11,
        "w": 24,
        "x": 0,
        "y": 199
      },
      "id": 5,
      "options": {
        "basemap": {
          "config": {},
          "name": "Layer 0",
          "noRepeat": false,
          "type": "default"
        },
        "controls": {
          "mouseWheelZoom": true,
          "showAttribution": true,
          "showDebug": false,
          "showMeasure": false,
          "showScale": false,
          "showZoom": true
        },
        "layers": [
          {
            "config": {
              "blur": 50,
              "radius": 50,
              "weight": {
                "fixed": 1,
                "max": 1,
                "min": 0
              }
            },
            "filterData": {
              "id": "byRefId",
              "options": "A"
            },
            "layer-tooltip": true,
            "location": {
              "mode": "auto"
            },
            "name": "Layer 1",
            "opacity": 0.5,
            "tooltip": true,
            "type": "heatmap"
          }
        ],
        "tooltip": {
          "mode": "details"
        },
        "view": {
          "allLayers": true,
          "id": "coords",
          "lat": 50.599922,
          "lon": 4.32828,
          "noRepeat": false,
          "zoom": 17.78
        }
      },
      "pluginVersion": "12.3.2",
      "targets": [
        {
          "hide": false,
          "query": "import \"array\"\n\narray.from(rows: [{\n    lat: 50.599724, \n    lon: 4.328188, \n    location_name: \"Ext√©rieur, Jardin\",\n    sensor_type: \"Trotec SL400\"\n}])",
          "refId": "A"
        }
      ],
      "title": "Localisation du Capteur",
      "type": "geomap"
    }
  ],
  "preload": false,
  "refresh": "",
  "schemaVersion": 42,
  "tags": [],
  "templating": {
    "list": [
      {
        "auto": false,
        "auto_count": 30,
        "auto_min": "10s",
        "current": {
          "text": "30m",
          "value": "30m"
        },
        "description": "Elle repr√©sente la p√©riode de temps totale sur laquelle le niveau sonore est moyenn√© de mani√®re √©nerg√©tique.",
        "label": "Dur√©e d'int√©gration",
        "name": "interval",
        "options": [
          {
            "selected": false,
            "text": "1s",
            "value": "1s"
          },
          {
            "selected": false,
            "text": "2s",
            "value": "2s"
          },
          {
            "selected": false,
            "text": "5s",
            "value": "5s"
          },
          {
            "selected": false,
            "text": "10s",
            "value": "10s"
          },
          {
            "selected": false,
            "text": "30s",
            "value": "30s"
          },
          {
            "selected": false,
            "text": "1m",
            "value": "1m"
          },
          {
            "selected": false,
            "text": "2m",
            "value": "2m"
          },
          {
            "selected": false,
            "text": "5m",
            "value": "5m"
          },
          {
            "selected": false,
            "text": "10m",
            "value": "10m"
          },
          {
            "selected": true,
            "text": "30m",
            "value": "30m"
          },
          {
            "selected": false,
            "text": "1h",
            "value": "1h"
          },
          {
            "selected": false,
            "text": "1d",
            "value": "1d"
          }
        ],
        "query": "1s,2s,5s,10s,30s,1m,2m,5m,10m,30m,1h,1d",
        "refresh": 2,
        "type": "interval"
      }
    ]
  },
  "time": {
    "from": "now-24h",
    "to": "now"
  },
  "timepicker": {
    "refresh_intervals": ["5s", "10s", "30s", "1m", "5m", "15m", "30m", "1h", "2h", "4h", "1d", "2d", "7d"]
  },
  "timezone": "browser",
  "title": "Noise Station",
  "uid": "noise-station",
  "version": 1,
  "weekStart": "monday"
}
